# Step 14. Service and Client C++

## 1. Service Node
Here we'll create the service ("add_two_ints_server") node which will receive two ints and return the sum. 
```
$ roscd beginner_tutorials/src
$ touch add_two_ints_server.cpp
```

### code explanation

```
#include "ros/ros.h"
#include "beginner_tutorials/AddTwoInts.h"
```
beginner_tutorials/AddTwoInts.h is the header file generated from the srv file that we created earlier. 
```
bool add(beginner_tutorials::AddTwoInts::Request  &req,
         beginner_tutorials::AddTwoInts::Response &res)
```
This function provides the service for adding two ints, it takes in the request and response type defined in the srv file and returns a boolean. 
```
{
  res.sum = req.a + req.b;
  ROS_INFO("request: x=%ld, y=%ld", (long int)req.a, (long int)req.b);
  ROS_INFO("sending back response: [%ld]", (long int)res.sum);
  return true;
}
```
Here the two ints are added and stored in the response. Then some information about the request and response are logged. Finally the service returns true when it is complete. 
```
  ros::ServiceServer service = n.advertiseService("add_two_ints", add);
```

## 2. Client Node
```
$ roscd beginner_tutorials/src
$ touch add_two_ints_client.cpp
```

### code explanation
```
  ros::ServiceClient client = n.serviceClient<beginner_tutorials::AddTwoInts>("add_two_ints");
```

This creates a client for the add_two_ints service. The ros::ServiceClient object is used to call the service later on. 

```
  beginner_tutorials::AddTwoInts srv;
  srv.request.a = atoll(argv[1]);
  srv.request.b = atoll(argv[2]);
```
Here we instantiate an autogenerated service class, and assign values into its request member. A service class contains two members, request and response. It also contains two class definitions, Request and Response. 
```
  if (client.call(srv))
```
This actually calls the service. Since service calls are blocking, it will return once the call is done. If the service call succeeded, call() will return true and the value in srv.response will be valid. If the call did not succeed, call() will return false and the value in srv.response will be invalid. 

## 3. Building nodes
Add this at the end of ~/catkin_ws/src/beginner_tutorials/CMakeLists.txt
```
add_executable(add_two_ints_server src/add_two_ints_server.cpp)
target_link_libraries(add_two_ints_server ${catkin_LIBRARIES})
add_dependencies(add_two_ints_server beginner_tutorials_gencpp)

add_executable(add_two_ints_client src/add_two_ints_client.cpp)
target_link_libraries(add_two_ints_client ${catkin_LIBRARIES})
add_dependencies(add_two_ints_client beginner_tutorials_gencpp)
```
```
# In your catkin workspace
$ cd ~/catkin_ws
$ catkin_make
```

## 4. Examining the Simple Service and Client
Start the service:
```
$ rosrun beginner_tutorials add_two_ints_server
```
Run the client
```
$ rosrun beginner_tutorials add_two_ints_client 1 3
```
Result:
```
Requesting 1+3
1 + 3 = 4
```